---
phase: 05-ui-polish
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - src/app/dashboard/signals/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can type in search box and see matching signals"
    - "User can filter signals by priority level (high, medium, low)"
    - "Search and priority filters combine with existing type and date filters"
    - "All filter values persist in URL for sharing"
  artifacts:
    - path: "src/app/dashboard/signals/page.tsx"
      provides: "Search input and priority filter toggles"
      contains: "search"
  key_links:
    - from: "src/app/dashboard/signals/page.tsx"
      to: "/api/signals"
      via: "fetch with search and priorities params"
      pattern: "search.*priorities"
---

<objective>
Add search input and priority filter controls to the signals page.

Purpose: Users need to quickly find specific signals by company name or filter by urgency level (high/medium/low priority).
Output: Signals page with search input (debounced) and priority toggle buttons, integrated with existing filter system.
</objective>

<execution_context>
@/home/qualia/.claude/get-shit-done/workflows/execute-plan.md
@/home/qualia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Plan 05-01 added pagination - we build on that
@.planning/phases/05-ui-polish/05-01-SUMMARY.md

# API already supports search and priorities params
@src/lib/queries/signals.ts
@src/app/api/signals/route.ts
@src/app/dashboard/signals/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add search input with debounce</name>
  <files>src/app/dashboard/signals/page.tsx</files>
  <action>
Add a search input that filters signals by company name or title:

1. Add local state for search input (for debounce):
   ```tsx
   const [searchInput, setSearchInput] = useState(searchQuery);
   ```

2. Add debounce effect to sync local input to URL (300ms delay):
   ```tsx
   useEffect(() => {
     const timer = setTimeout(() => {
       if (searchInput !== searchQuery) {
         const params = new URLSearchParams(searchParams.toString());
         if (searchInput.trim()) {
           params.set("search", searchInput.trim());
         } else {
           params.delete("search");
         }
         params.delete("page"); // Reset pagination on search
         router.push(`/dashboard/signals?${params.toString()}`);
       }
     }, 300);
     return () => clearTimeout(timer);
   }, [searchInput]);
   ```

3. Add search input UI in the filter section (after "Time:" filters):
   ```tsx
   {/* Search input */}
   <div className="flex items-center gap-2">
     <span className="text-xs text-[var(--text-tertiary)] mr-1">Search:</span>
     <div className="relative">
       <input
         type="text"
         value={searchInput}
         onChange={(e) => setSearchInput(e.target.value)}
         placeholder="Company or keyword..."
         className="h-8 px-3 text-sm bg-[var(--bg-primary)] border border-[var(--border-subtle)] rounded-md
                    placeholder:text-[var(--text-tertiary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent)]/20
                    focus:border-[var(--accent)] w-48 transition-colors"
       />
       {searchInput && (
         <button
           onClick={() => setSearchInput("")}
           className="absolute right-2 top-1/2 -translate-y-1/2 text-[var(--text-tertiary)] hover:text-[var(--text-primary)]"
         >
           <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
             <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
           </svg>
         </button>
       )}
     </div>
   </div>
   ```

4. Sync searchInput from URL on mount (keep local and URL in sync):
   ```tsx
   useEffect(() => {
     setSearchInput(searchQuery);
   }, [searchQuery]);
   ```

Design notes:
- Use existing CSS variables for consistency
- Add clear button (X) when search has content
- Keep input width reasonable (w-48, ~192px)
- Reset pagination when search changes (user expects first results)
  </action>
  <verify>
Type "acme" in search, wait 300ms - URL updates to include `?search=acme`.
Clear search - URL removes search param.
Signals list shows only signals with "acme" in title or company_name.
  </verify>
  <done>
Search input filters signals by company name or title keyword with 300ms debounce.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add priority filter toggles</name>
  <files>src/app/dashboard/signals/page.tsx</files>
  <action>
Add priority filter buttons matching the existing type filter pattern:

1. Define priority filter config (similar to signalFilters):
   ```tsx
   const priorityFilters: { priority: SignalPriority; label: string }[] = [
     { priority: "high", label: "High" },
     { priority: "medium", label: "Medium" },
     { priority: "low", label: "Low" },
   ];
   ```

2. Import SignalPriority type if not already imported:
   ```tsx
   import type { Signal, SignalType, SignalPriority } from "@/types";
   ```

3. Create togglePriorityFilter function (mirrors toggleTypeFilter):
   ```tsx
   const togglePriorityFilter = (priority: SignalPriority) => {
     const current = new Set(activePriorities);
     if (current.has(priority)) {
       current.delete(priority);
     } else {
       current.add(priority);
     }

     const params = new URLSearchParams(searchParams.toString());
     if (current.size > 0) {
       params.set("priorities", Array.from(current).join(","));
     } else {
       params.delete("priorities");
     }
     params.delete("page"); // Reset pagination on filter change
     router.push(`/dashboard/signals?${params.toString()}`);
   };
   ```

4. Add priority filter UI row (after Type filters, before Time filters):
   ```tsx
   {/* Priority filters */}
   <div className="flex items-center gap-2 flex-wrap">
     <span className="text-xs text-[var(--text-tertiary)] mr-1">Priority:</span>
     <Button
       variant={activePriorities.length === 0 ? "default" : "secondary"}
       size="sm"
       onClick={() => {
         const params = new URLSearchParams(searchParams.toString());
         params.delete("priorities");
         params.delete("page");
         router.push(`/dashboard/signals?${params.toString()}`);
       }}
     >
       All Priorities
     </Button>
     <div className="flex items-center gap-1">
       {priorityFilters.map((filter) => {
         const isActive = activePriorities.includes(filter.priority);
         return (
           <button
             key={filter.priority}
             onClick={() => togglePriorityFilter(filter.priority)}
             className={`px-2.5 py-1.5 text-xs font-medium rounded-md transition-colors ${
               isActive
                 ? "bg-[var(--accent)] text-white"
                 : "text-[var(--text-tertiary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-secondary)]"
             }`}
           >
             {filter.label}
           </button>
         );
       })}
     </div>
   </div>
   ```

5. Note: activePriorities is already read from URL in the existing code:
   ```tsx
   const activePriorities = searchParams.get("priorities")?.split(",").filter(Boolean) || [];
   ```

6. Verify the fetch useEffect includes activePriorities in its dependency array (already does based on current code).

Design notes:
- Match type filter styling exactly (same button classes, same spacing)
- Allow multi-select (user can filter high AND medium)
- Reset pagination when priority filter changes
  </action>
  <verify>
Click "High" priority filter - URL updates to `?priorities=high`.
Click "Medium" while "High" is active - URL shows `?priorities=high,medium`.
Signals list filters correctly.
"All Priorities" button clears priority filter.
  </verify>
  <done>
Priority filter toggles work with multi-select, integrate with existing filter system.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Clear Filters to include new filters</name>
  <files>src/app/dashboard/signals/page.tsx</files>
  <action>
Update the "Clear Filters" button in empty state to also clear search and priorities:

1. Update the condition that shows Clear Filters button:
   ```tsx
   {(activeTypes.length > 0 || activePriorities.length > 0 || searchQuery || from) && (
   ```

2. Update the Clear Filters onClick to clear all filter types:
   ```tsx
   onClick={() => {
     router.push("/dashboard/signals");
   }}
   ```
   (This already clears all params - just need to update the condition)

3. Update the empty state message to mention search:
   ```tsx
   {activeTypes.length > 0 || activePriorities.length > 0 || searchQuery || from
     ? "No signals match your current filters. Try adjusting your search, filters, or clearing them to see all signals."
     : "Axidex will automatically detect buying signals..."}
   ```

4. Also ensure the stats bar conditional variant button uses all filter conditions:
   ```tsx
   <Button variant={activeTypes.length > 0 || activePriorities.length > 0 || searchQuery || from ? "secondary" : "default"}>
   ```
  </action>
  <verify>
With search active, empty state shows "Clear Filters" button.
With priority filter active, empty state shows "Clear Filters" button.
Clicking "Clear Filters" removes all filters (types, priorities, search, dates).
  </verify>
  <done>
Clear Filters button accounts for all filter types including new search and priority filters.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - no TypeScript errors
2. Search: Type "acme", 300ms delay, URL updates, list filters
3. Priority: Click High, URL shows `?priorities=high`, list filters
4. Combined: Type + Priority + Search + Date all work together
5. Pagination: Changing any filter resets to page 1
6. URL shareable: Copy URL with filters, paste in new tab - same view
7. Clear Filters: Works for all filter types
</verification>

<success_criteria>
- Search input filters signals with debounce
- Priority toggle buttons work (multi-select)
- All filters combine correctly
- Filter state persists in URL
- Clear Filters handles all filter types
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-polish/05-02-SUMMARY.md`
</output>
